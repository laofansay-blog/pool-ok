<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简单下注测试</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 600px; 
            margin: 50px auto; 
            padding: 20px; 
            background: #f0f0f0;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button { 
            background: #4CAF50; 
            color: white; 
            padding: 15px 30px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 16px;
            margin: 10px 5px;
            width: 100%;
        }
        button:hover { background: #45a049; }
        .result { 
            background: #f9f9f9; 
            padding: 20px; 
            border-radius: 5px; 
            margin: 20px 0; 
            white-space: pre-wrap; 
            font-family: monospace;
            border-left: 4px solid #ddd;
        }
        .success { border-left-color: #4CAF50; }
        .error { border-left-color: #f44336; }
        .info { border-left-color: #2196F3; }
        h1 { text-align: center; color: #333; }
        .step { margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎲 简单下注测试</h1>
        
        <div class="step">
            <h3>步骤 1: 检查配置</h3>
            <button onclick="checkConfig()">检查配置</button>
            <div id="configResult" class="result info">点击按钮检查配置...</div>
        </div>
        
        <div class="step">
            <h3>步骤 2: 测试函数连接</h3>
            <button onclick="testConnection()">测试连接</button>
            <div id="connectionResult" class="result info">点击按钮测试连接...</div>
        </div>
        
        <div class="step">
            <h3>步骤 3: 发送测试请求</h3>
            <button onclick="sendTestRequest()">发送测试请求</button>
            <div id="requestResult" class="result info">点击按钮发送测试请求...</div>
        </div>
    </div>

    <script>
        // 检查配置
        function checkConfig() {
            const result = document.getElementById('configResult')
            
            try {
                // 检查 config.js 是否加载
                if (typeof CONFIG === 'undefined') {
                    result.textContent = '❌ CONFIG 未定义，请检查 config.js 文件'
                    result.className = 'result error'
                    return
                }
                
                result.textContent = `✅ 配置检查通过:
Supabase URL: ${CONFIG.SUPABASE_URL}
Anon Key: ${CONFIG.SUPABASE_ANON_KEY ? '已设置' : '未设置'}
API 端点: ${CONFIG.API?.ENDPOINTS?.PLACE_BET || '未设置'}`
                result.className = 'result success'
                
            } catch (error) {
                result.textContent = `❌ 配置检查失败: ${error.message}`
                result.className = 'result error'
            }
        }
        
        // 测试连接
        async function testConnection() {
            const result = document.getElementById('connectionResult')
            result.textContent = '正在测试连接...'
            
            try {
                const url = `${CONFIG.SUPABASE_URL}/functions/v1/place-bet`
                
                // 测试 OPTIONS 请求
                const response = await fetch(url, {
                    method: 'OPTIONS',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                
                if (response.ok) {
                    result.textContent = `✅ 连接测试成功!
URL: ${url}
状态: ${response.status} ${response.statusText}
CORS: 支持`
                    result.className = 'result success'
                } else {
                    result.textContent = `❌ 连接测试失败:
状态: ${response.status} ${response.statusText}
URL: ${url}`
                    result.className = 'result error'
                }
                
            } catch (error) {
                result.textContent = `❌ 连接错误: ${error.message}`
                result.className = 'result error'
            }
        }
        
        // 发送测试请求
        async function sendTestRequest() {
            const result = document.getElementById('requestResult')
            result.textContent = '正在发送测试请求...'
            
            try {
                const testData = {
                    bets: [
                        { group: 1, number: 1, amount: 2 },
                        { group: 1, number: 2, amount: 2 }
                    ],
                    totalAmount: 4,
                    userId: 'test-user-123'
                }
                
                console.log('发送数据:', testData)
                
                const response = await fetch(`${CONFIG.SUPABASE_URL}/functions/v1/place-bet`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${CONFIG.SUPABASE_ANON_KEY}`,
                        'apikey': CONFIG.SUPABASE_ANON_KEY
                    },
                    body: JSON.stringify(testData)
                })
                
                const responseText = await response.text()
                console.log('响应:', responseText)
                
                result.textContent = `📋 测试请求结果:
状态: ${response.status} ${response.statusText}
响应: ${responseText}

发送的数据:
${JSON.stringify(testData, null, 2)}`
                
                if (response.ok) {
                    result.className = 'result success'
                } else {
                    result.className = 'result error'
                }
                
            } catch (error) {
                result.textContent = `❌ 请求错误: ${error.message}`
                result.className = 'result error'
                console.error('请求错误:', error)
            }
        }
        
        // 页面加载时自动检查配置
        window.addEventListener('load', () => {
            // 延迟一点确保 config.js 加载完成
            setTimeout(() => {
                checkConfig()
            }, 500)
        })
    </script>
    
    <!-- 加载配置文件 -->
    <script src="config.js"></script>
</body>
</html>
