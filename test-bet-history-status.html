<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ•æ³¨è®°å½•çŠ¶æ€æµ‹è¯•</title>
    <link rel="stylesheet" href="web/styles/main.css">
    <link rel="stylesheet" href="web/styles/winning-numbers.css">
    <style>
        body {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Microsoft YaHei', sans-serif;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .test-title {
            color: white;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }

        .test-section {
            margin-bottom: 30px;
        }

        .section-title {
            color: rgba(255, 255, 255, 0.9);
            font-size: 18px;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 8px;
        }
    </style>
</head>

<body>
    <div class="test-container">
        <h1 class="test-title">æŠ•æ³¨è®°å½•çŠ¶æ€æµ‹è¯•</h1>

        <div class="test-section">
            <h2 class="section-title">æµ‹è¯•æŠ•æ³¨è®°å½•åˆ—è¡¨</h2>
            <div id="betHistoryTable"></div>
        </div>

        <div class="test-section">
            <h2 class="section-title">è¯´æ˜</h2>
            <div style="color: rgba(255,255,255,0.8); line-height: 1.6;">
                <p>è¿™ä¸ªæµ‹è¯•é¡µé¢éªŒè¯æŠ•æ³¨è®°å½•åˆ—è¡¨ä¸­çš„ä¸­å¥–çŠ¶æ€æ˜¯å¦æ­£ç¡®æ˜¾ç¤ºï¼š</p>
                <ul>
                    <li><strong>ç¬¬138æœŸ</strong>ï¼šæŠ•æ³¨ [1-1,2], [2-3], [5-7] â†’ å¼€å¥– [1,5,3,8,2,9,4,6,10,7] â†’ åº”è¯¥æ˜¾ç¤º"ä¸­å¥–"ï¼ˆ3ç»„éƒ½ä¸­å¥–ï¼‰
                    </li>
                    <li><strong>ç¬¬137æœŸ</strong>ï¼šæŠ•æ³¨ [1-5], [3-8], [10-2] â†’ å¼€å¥– [2,7,1,4,9,6,3,5,8,10] â†’ åº”è¯¥æ˜¾ç¤º"ä¸­å¥–"ï¼ˆ3ç»„éƒ½ä¸­å¥–ï¼‰
                    </li>
                    <li><strong>ç¬¬175æœŸ</strong>ï¼šæŠ•æ³¨å¤šç»„ â†’ å¼€å¥– [10,5,6,3,5,2,8,5,5,4] â†’ åº”è¯¥æ˜¾ç¤º"ä¸­å¥–"ï¼ˆ6ç»„ä¸­å¥–ï¼‰</li>
                </ul>
                <p><strong>é«˜äº®æ•ˆæœï¼š</strong></p>
                <ul>
                    <li>ğŸ† ä¸­å¥–è®°å½•ä¼šæœ‰ç»¿è‰²æ¸å˜èƒŒæ™¯å’Œå·¦ä¾§ç»¿è‰²è¾¹æ¡†</li>
                    <li>âœ¨ ä¸­å¥–çŠ¶æ€æ ‡ç­¾ä¼šæ˜¯ç»¿è‰²çš„</li>
                    <li>ğŸ’° æ”¶ç›Šé‡‘é¢ä¼šæœ‰ç»¿è‰²é«˜äº®å’Œé‡‘å¸å›¾æ ‡</li>
                    <li>ğŸŒŸ æ•´è¡Œä¼šæœ‰è½»å¾®çš„å‘å…‰åŠ¨ç”»æ•ˆæœ</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="web/scripts/winning-numbers.js"></script>
    <script>
        // æµ‹è¯•æŠ•æ³¨è®°å½•æ•°æ®
        const testBets = [
            {
                id: 'test-bet-1',
                selected_numbers: {
                    "1": [1, 2],
                    "2": [3],
                    "5": [7]
                },
                bet_amount: 15.00,
                potential_payout: 147.00,
                actual_payout: 147.00,
                is_winner: true,
                status: 'settled',
                placed_at: '2024-12-01T14:35:00Z',
                rounds: {
                    round_number: 138,
                    winning_numbers: [1, 5, 3, 8, 2, 9, 4, 6, 10, 7]
                }
            },
            {
                id: 'test-bet-2',
                selected_numbers: {
                    "1": [5],
                    "3": [8],
                    "10": [2]
                },
                bet_amount: 9.00,
                potential_payout: 88.20,
                actual_payout: 88.20,
                is_winner: false, // æ•°æ®åº“ä¸­é”™è¯¯çš„çŠ¶æ€
                status: 'settled',
                placed_at: '2024-12-01T13:35:00Z',
                rounds: {
                    round_number: 137,
                    winning_numbers: [2, 7, 1, 4, 9, 6, 3, 5, 8, 10]
                }
            },
            {
                id: 'test-bet-175',
                selected_numbers: {
                    "1": [6, 7, 8, 9, 10],  // å¼€å¥–10 âœ…
                    "2": [6, 7, 8, 9, 10],  // å¼€å¥–5 âŒ
                    "3": [1, 2, 3, 4, 5],   // å¼€å¥–6 âŒ
                    "4": [1, 2, 3, 4, 5],   // å¼€å¥–3 âœ…
                    "5": [1, 2, 3, 4, 5],   // å¼€å¥–5 âœ…
                    "6": [1, 2, 3, 4, 5],   // å¼€å¥–2 âœ…
                    "7": [6, 7, 8, 9, 10],  // å¼€å¥–8 âœ…
                    "8": [1, 2, 3, 4, 5],   // å¼€å¥–5 âœ…
                    "9": [6, 7, 8, 9, 10],  // å¼€å¥–5 âŒ
                    "10": [6, 7, 8, 9, 10]  // å¼€å¥–4 âŒ
                },
                bet_amount: 60.00,
                potential_payout: 588.00,
                actual_payout: 78.40,
                is_winner: false, // æ•°æ®åº“ä¸­é”™è¯¯çš„çŠ¶æ€
                status: 'settled',
                placed_at: '2024-12-01T10:35:00Z',
                rounds: {
                    round_number: 175,
                    winning_numbers: [10, 5, 6, 3, 5, 2, 8, 5, 5, 4]
                }
            }
        ]

        // æ ¼å¼åŒ–è´§å¸
        function formatCurrency(amount) {
            return 'Â¥' + amount.toFixed(2)
        }

        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(timeString) {
            if (!timeString) return '-'
            return new Date(timeString).toLocaleString('zh-CN')
        }

        // æ¸²æŸ“æŠ•æ³¨è®°å½•è¡¨æ ¼
        function renderBetHistoryTable(bets) {
            return `
                <div class="bet-history-container">
                    <div class="bet-list-section">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>è½®æ¬¡</th>
                                        <th>é€‰æ‹©æ•°å­—</th>
                                        <th>æŠ•æ³¨é‡‘é¢</th>
                                        <th>çŠ¶æ€</th>
                                        <th>æ”¶ç›Š</th>
                                        <th>æ—¶é—´</th>
                                        <th>åˆ†æ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${bets.map(bet => {
                // å®æ—¶è®¡ç®—æ˜¯å¦ä¸­å¥–
                let isActualWinner = false
                let winningAnalysis = ''
                if (bet.rounds?.winning_numbers && bet.rounds.winning_numbers.length > 0) {
                    const stats = WinningNumbers.calculateWinningStats(bet.selected_numbers, bet.rounds.winning_numbers)
                    isActualWinner = stats.winningGroups >= 1
                    winningAnalysis = `${stats.winningGroups}/${stats.totalGroups}ç»„ä¸­å¥– (${(stats.winRate * 100).toFixed(1)}%)`
                } else {
                    isActualWinner = bet.is_winner
                    winningAnalysis = 'æœªå¼€å¥–'
                }

                return `
                                            <tr class="${isActualWinner ? 'winner' : ''}">
                                                <td>ç¬¬${bet.rounds?.round_number || '-'}æœŸ</td>
                                                <td>${WinningNumbers.renderBetNumbers(bet.selected_numbers)}</td>
                                                <td>${formatCurrency(bet.bet_amount)}</td>
                                                <td>
                                                    <span class="status ${bet.status}">
                                                        ${bet.status === 'settled' ? (isActualWinner ? 'ä¸­å¥–' : 'æœªä¸­å¥–') : 'å¾…å¼€å¥–'}
                                                    </span>
                                                    ${bet.is_winner !== isActualWinner ?
                        `<br><small style="color: #ffc107;">æ•°æ®åº“: ${bet.is_winner ? 'ä¸­å¥–' : 'æœªä¸­å¥–'}</small>` :
                        ''
                    }
                                                </td>
                                                <td class="${bet.actual_payout > 0 ? 'positive' : ''}">
                                                    ${formatCurrency(bet.actual_payout)}
                                                </td>
                                                <td>${formatTime(bet.placed_at)}</td>
                                                <td>
                                                    <small>${winningAnalysis}</small>
                                                    ${bet.rounds?.winning_numbers ?
                        `<br><small style="color: rgba(255,255,255,0.6);">å¼€å¥–: ${bet.rounds.winning_numbers.join(',')}</small>` :
                        ''
                    }
                                                </td>
                                            </tr>
                                        `
            }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `
        }

        // åˆå§‹åŒ–é¡µé¢
        function init() {
            document.getElementById('betHistoryTable').innerHTML = renderBetHistoryTable(testBets)
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init)
    </script>
</body>

</html>