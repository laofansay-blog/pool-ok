<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€å•ä¸‹æ³¨æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 600px; 
            margin: 50px auto; 
            padding: 20px; 
            background: #f0f0f0;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button { 
            background: #4CAF50; 
            color: white; 
            padding: 15px 30px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 16px;
            margin: 10px 5px;
            width: 100%;
        }
        button:hover { background: #45a049; }
        .result { 
            background: #f9f9f9; 
            padding: 20px; 
            border-radius: 5px; 
            margin: 20px 0; 
            white-space: pre-wrap; 
            font-family: monospace;
            border-left: 4px solid #ddd;
        }
        .success { border-left-color: #4CAF50; }
        .error { border-left-color: #f44336; }
        .info { border-left-color: #2196F3; }
        h1 { text-align: center; color: #333; }
        .step { margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ² ç®€å•ä¸‹æ³¨æµ‹è¯•</h1>
        
        <div class="step">
            <h3>æ­¥éª¤ 1: æ£€æŸ¥é…ç½®</h3>
            <button onclick="checkConfig()">æ£€æŸ¥é…ç½®</button>
            <div id="configResult" class="result info">ç‚¹å‡»æŒ‰é’®æ£€æŸ¥é…ç½®...</div>
        </div>
        
        <div class="step">
            <h3>æ­¥éª¤ 2: æµ‹è¯•å‡½æ•°è¿æ¥</h3>
            <button onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
            <div id="connectionResult" class="result info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•è¿æ¥...</div>
        </div>
        
        <div class="step">
            <h3>æ­¥éª¤ 3: å‘é€æµ‹è¯•è¯·æ±‚</h3>
            <button onclick="sendTestRequest()">å‘é€æµ‹è¯•è¯·æ±‚</button>
            <div id="requestResult" class="result info">ç‚¹å‡»æŒ‰é’®å‘é€æµ‹è¯•è¯·æ±‚...</div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥é…ç½®
        function checkConfig() {
            const result = document.getElementById('configResult')
            
            try {
                // æ£€æŸ¥ config.js æ˜¯å¦åŠ è½½
                if (typeof CONFIG === 'undefined') {
                    result.textContent = 'âŒ CONFIG æœªå®šä¹‰ï¼Œè¯·æ£€æŸ¥ config.js æ–‡ä»¶'
                    result.className = 'result error'
                    return
                }
                
                result.textContent = `âœ… é…ç½®æ£€æŸ¥é€šè¿‡:
Supabase URL: ${CONFIG.SUPABASE_URL}
Anon Key: ${CONFIG.SUPABASE_ANON_KEY ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}
API ç«¯ç‚¹: ${CONFIG.API?.ENDPOINTS?.PLACE_BET || 'æœªè®¾ç½®'}`
                result.className = 'result success'
                
            } catch (error) {
                result.textContent = `âŒ é…ç½®æ£€æŸ¥å¤±è´¥: ${error.message}`
                result.className = 'result error'
            }
        }
        
        // æµ‹è¯•è¿æ¥
        async function testConnection() {
            const result = document.getElementById('connectionResult')
            result.textContent = 'æ­£åœ¨æµ‹è¯•è¿æ¥...'
            
            try {
                const url = `${CONFIG.SUPABASE_URL}/functions/v1/place-bet`
                
                // æµ‹è¯• OPTIONS è¯·æ±‚
                const response = await fetch(url, {
                    method: 'OPTIONS',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                
                if (response.ok) {
                    result.textContent = `âœ… è¿æ¥æµ‹è¯•æˆåŠŸ!
URL: ${url}
çŠ¶æ€: ${response.status} ${response.statusText}
CORS: æ”¯æŒ`
                    result.className = 'result success'
                } else {
                    result.textContent = `âŒ è¿æ¥æµ‹è¯•å¤±è´¥:
çŠ¶æ€: ${response.status} ${response.statusText}
URL: ${url}`
                    result.className = 'result error'
                }
                
            } catch (error) {
                result.textContent = `âŒ è¿æ¥é”™è¯¯: ${error.message}`
                result.className = 'result error'
            }
        }
        
        // å‘é€æµ‹è¯•è¯·æ±‚
        async function sendTestRequest() {
            const result = document.getElementById('requestResult')
            result.textContent = 'æ­£åœ¨å‘é€æµ‹è¯•è¯·æ±‚...'
            
            try {
                const testData = {
                    bets: [
                        { group: 1, number: 1, amount: 2 },
                        { group: 1, number: 2, amount: 2 }
                    ],
                    totalAmount: 4,
                    userId: 'test-user-123'
                }
                
                console.log('å‘é€æ•°æ®:', testData)
                
                const response = await fetch(`${CONFIG.SUPABASE_URL}/functions/v1/place-bet`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${CONFIG.SUPABASE_ANON_KEY}`,
                        'apikey': CONFIG.SUPABASE_ANON_KEY
                    },
                    body: JSON.stringify(testData)
                })
                
                const responseText = await response.text()
                console.log('å“åº”:', responseText)
                
                result.textContent = `ğŸ“‹ æµ‹è¯•è¯·æ±‚ç»“æœ:
çŠ¶æ€: ${response.status} ${response.statusText}
å“åº”: ${responseText}

å‘é€çš„æ•°æ®:
${JSON.stringify(testData, null, 2)}`
                
                if (response.ok) {
                    result.className = 'result success'
                } else {
                    result.className = 'result error'
                }
                
            } catch (error) {
                result.textContent = `âŒ è¯·æ±‚é”™è¯¯: ${error.message}`
                result.className = 'result error'
                console.error('è¯·æ±‚é”™è¯¯:', error)
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥é…ç½®
        window.addEventListener('load', () => {
            // å»¶è¿Ÿä¸€ç‚¹ç¡®ä¿ config.js åŠ è½½å®Œæˆ
            setTimeout(() => {
                checkConfig()
            }, 500)
        })
    </script>
    
    <!-- åŠ è½½é…ç½®æ–‡ä»¶ -->
    <script src="config.js"></script>
</body>
</html>
