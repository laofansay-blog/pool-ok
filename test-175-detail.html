<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬175æœŸæŠ•æ³¨è¯¦æƒ…æµ‹è¯•</title>
    <link rel="stylesheet" href="web/styles/main.css">
    <link rel="stylesheet" href="web/styles/winning-numbers.css">
    <style>
        body {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Microsoft YaHei', sans-serif;
        }

        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .test-title {
            color: white;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="test-container">
        <h1 class="test-title">ç¬¬175æœŸæŠ•æ³¨è¯¦æƒ…æµ‹è¯•</h1>
        <div id="betDetail"></div>
    </div>

    <script src="web/scripts/winning-numbers.js"></script>
    <script>
        // æ¨¡æ‹Ÿç¬¬175æœŸçš„æŠ•æ³¨æ•°æ®
        const bet175 = {
            id: 'test-bet-175',
            user_id: 'test-user',
            round_id: 'round-175',
            selected_numbers: {
                "1": [6, 7, 8, 9, 10],  // å¼€å¥–10 âœ…
                "2": [6, 7, 8, 9, 10],  // å¼€å¥–5 âŒ
                "3": [1, 2, 3, 4, 5],   // å¼€å¥–6 âŒ
                "4": [1, 2, 3, 4, 5],   // å¼€å¥–3 âœ…
                "5": [1, 2, 3, 4, 5],   // å¼€å¥–5 âœ…
                "6": [1, 2, 3, 4, 5],   // å¼€å¥–2 âœ…
                "7": [6, 7, 8, 9, 10],  // å¼€å¥–8 âœ…
                "8": [1, 2, 3, 4, 5],   // å¼€å¥–5 âœ…
                "9": [6, 7, 8, 9, 10],  // å¼€å¥–5 âŒ
                "10": [6, 7, 8, 9, 10]  // å¼€å¥–4 âŒ
            },
            bet_amount: 60.00,
            potential_payout: 588.00,
            actual_payout: 78.40,  // æŒ‰æ–°è®¡ç®—æ–¹å¼ï¼š6ç»„ä¸­å¥– Ã— 2å…ƒ Ã— 9.8å€ = 117.6å…ƒï¼ˆå‡è®¾ï¼‰
            is_winner: true,
            status: 'settled',
            placed_at: '2024-12-01T10:35:00Z',
            settled_at: '2024-12-01T11:00:00Z',
            metadata: {
                original_bets: [
                    { group: 1, number: 6, amount: 2 },
                    { group: 1, number: 7, amount: 2 },
                    { group: 1, number: 8, amount: 2 },
                    { group: 1, number: 9, amount: 2 },
                    { group: 1, number: 10, amount: 2 },  // ä¸­å¥–
                    { group: 2, number: 6, amount: 2 },
                    { group: 2, number: 7, amount: 2 },
                    { group: 2, number: 8, amount: 2 },
                    { group: 2, number: 9, amount: 2 },
                    { group: 2, number: 10, amount: 2 },
                    // ... å…¶ä»–æŠ•æ³¨
                    { group: 4, number: 3, amount: 2 },   // ä¸­å¥–
                    { group: 5, number: 5, amount: 2 },   // ä¸­å¥–
                    { group: 6, number: 2, amount: 2 },   // ä¸­å¥–
                    { group: 7, number: 8, amount: 2 },   // ä¸­å¥–
                    { group: 8, number: 5, amount: 2 }    // ä¸­å¥–
                ]
            }
        }

        const round175 = {
            round_number: 175,
            winning_numbers: [10, 5, 6, 3, 5, 2, 8, 5, 5, 4],
            status: 'completed',
            start_time: '2024-12-01T10:30:00Z',
            end_time: '2024-12-01T10:59:00Z',
            draw_time: '2024-12-01T11:00:00Z'
        }

        // æ ¼å¼åŒ–è´§å¸
        function formatCurrency(amount) {
            return 'Â¥' + amount.toFixed(2)
        }

        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(timeString) {
            if (!timeString) return '-'
            return new Date(timeString).toLocaleString('zh-CN')
        }

        // æ¸²æŸ“ä¸­å¥–ç»Ÿè®¡
        function renderWinningStats(selectedNumbers, winningNumbers) {
            const stats = WinningNumbers.calculateWinningStats(selectedNumbers, winningNumbers)

            if (stats.totalGroups === 0) {
                return ''
            }

            const hasWinnings = stats.winningGroups > 0
            const winRate = (stats.winRate * 100).toFixed(1)

            return `
                <div class="winning-stats ${hasWinnings ? 'has-winnings' : ''}">
                    <div class="winning-stats-title">
                        ${hasWinnings ? 'ğŸ¯' : 'ğŸ“Š'} ä¸­å¥–ç»Ÿè®¡
                    </div>
                    <div class="winning-stats-content">
                        <div class="winning-stat-item">
                            <div class="winning-stat-label">æŠ•æ³¨ç»„æ•°</div>
                            <div class="winning-stat-value">${stats.totalGroups}</div>
                        </div>
                        <div class="winning-stat-item">
                            <div class="winning-stat-label">ä¸­å¥–ç»„æ•°</div>
                            <div class="winning-stat-value ${hasWinnings ? 'success' : ''}">${stats.winningGroups}</div>
                        </div>
                        <div class="winning-stat-item">
                            <div class="winning-stat-label">ä¸­å¥–ç‡</div>
                            <div class="winning-stat-value ${hasWinnings ? 'highlight' : ''}">${winRate}%</div>
                        </div>
                    </div>
                    ${hasWinnings ? `
                        <div style="margin-top: 10px; font-size: 14px; color: rgba(255,255,255,0.8);">
                            ä¸­å¥–ç»„åˆ«: ${stats.winningDetails
                        .filter(detail => detail.isWinning)
                        .map(detail => `ç¬¬${detail.group}ç»„`)
                        .join(', ')}
                        </div>
                    ` : ''}
                </div>
            `
        }

        // æ¸²æŸ“æŠ•æ³¨è¯¦æƒ…
        function renderBetDetail(bet, round) {
            // å®æ—¶è®¡ç®—æ˜¯å¦ä¸­å¥–
            let isActualWinner = false
            if (round?.winning_numbers && round.winning_numbers.length > 0) {
                const stats = WinningNumbers.calculateWinningStats(bet.selected_numbers, round.winning_numbers)
                isActualWinner = stats.winningGroups >= 1 // åªè¦æœ‰ä¸€ç»„ä¸­å¥–å°±ç®—ä¸­å¥–
            } else {
                isActualWinner = bet.is_winner
            }

            const profitLoss = bet.actual_payout - bet.bet_amount
            const profitLossClass = profitLoss > 0 ? 'positive' : profitLoss < 0 ? 'negative' : 'neutral'
            const profitLossText = profitLoss > 0 ? `+${formatCurrency(profitLoss)}` : formatCurrency(profitLoss)

            return `
                <div class="bet-detail-card">
                    <!-- åŸºæœ¬ä¿¡æ¯ -->
                    <div class="detail-section">
                        <h4 class="section-title">
                            <span class="section-icon">ğŸ“‹</span>
                            åŸºæœ¬ä¿¡æ¯
                            ${isActualWinner ? '<span class="winner-badge">ğŸ† ä¸­å¥–</span>' : ''}
                        </h4>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <div class="detail-label">æŠ•æ³¨ID</div>
                                <div class="detail-value">${bet.id}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">è½®æ¬¡</div>
                                <div class="detail-value">ç¬¬${round?.round_number || '-'}æœŸ</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">æŠ•æ³¨æ—¶é—´</div>
                                <div class="detail-value">${formatTime(bet.placed_at)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">çŠ¶æ€</div>
                                <div class="detail-value">
                                    <span class="status ${bet.status}">
                                        ${bet.status === 'settled' ? (isActualWinner ? 'å·²ä¸­å¥–' : 'æœªä¸­å¥–') : 'å¾…å¼€å¥–'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æŠ•æ³¨å†…å®¹ -->
                    <div class="detail-section">
                        <h4 class="section-title">
                            <span class="section-icon">ğŸ¯</span>
                            æŠ•æ³¨å†…å®¹
                        </h4>
                        <div class="bet-numbers-display">
                            ${WinningNumbers.renderBetNumbers(bet.selected_numbers, { size: 'medium' }, round?.winning_numbers)}
                        </div>
                        <div class="bet-description">
                            ${WinningNumbers.formatBetNumbersText(bet.selected_numbers)}
                        </div>
                        ${renderWinningStats(bet.selected_numbers, round?.winning_numbers)}
                    </div>

                    <!-- å¼€å¥–ç»“æœ -->
                    ${round?.winning_numbers && round.winning_numbers.length > 0 ? `
                        <div class="detail-section">
                            <h4 class="section-title">
                                <span class="section-icon">ğŸ²</span>
                                å¼€å¥–ç»“æœ
                            </h4>
                            <div class="winning-numbers-display">
                                ${WinningNumbers.renderDetailed(round.winning_numbers)}
                            </div>
                            <div class="draw-time">
                                å¼€å¥–æ—¶é—´: ${formatTime(round.draw_time)}
                            </div>
                        </div>
                    ` : ''}

                    <!-- å®é™…èµ”ä»˜é†’ç›®å±•ç¤º -->
                    ${(bet.actual_payout > 0 || isActualWinner) ? `
                        <div class="payout-highlight">
                            <div class="payout-highlight-title">
                                ğŸ‰ å®é™…èµ”ä»˜
                            </div>
                            <div class="payout-highlight-amount">
                                ${formatCurrency(bet.actual_payout)}
                            </div>
                            <div class="payout-highlight-subtitle">
                                æŠ•æ³¨ ${formatCurrency(bet.bet_amount)} â†’ è·å¾— ${formatCurrency(bet.actual_payout)} (${(bet.actual_payout / bet.bet_amount).toFixed(1)}å€)
                            </div>
                        </div>
                    ` : ''}

                    <!-- è´¢åŠ¡ä¿¡æ¯ -->
                    <div class="detail-section">
                        <h4 class="section-title">
                            <span class="section-icon">ğŸ’°</span>
                            è´¢åŠ¡ä¿¡æ¯
                        </h4>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <div class="detail-label">æŠ•æ³¨é‡‘é¢</div>
                                <div class="detail-value">${formatCurrency(bet.bet_amount)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">æ½œåœ¨èµ”ä»˜</div>
                                <div class="detail-value">${formatCurrency(bet.potential_payout)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">å®é™…èµ”ä»˜</div>
                                <div class="detail-value ${bet.actual_payout > 0 ? 'success' : ''}">${formatCurrency(bet.actual_payout)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">ç›ˆäº</div>
                                <div class="detail-value ${profitLossClass}">
                                    ${profitLossText}
                                </div>
                            </div>
                        </div>
                        
                        <div class="financial-analysis">
                            <div class="analysis-item">
                                <span>èµ”ç‡:</span>
                                <span>${(bet.potential_payout / bet.bet_amount).toFixed(2)}x</span>
                            </div>
                            <div class="analysis-item">
                                <span>æŠ•èµ„å›æŠ¥ç‡:</span>
                                <span class="${profitLossClass}">
                                    ${((profitLoss / bet.bet_amount) * 100).toFixed(2)}%
                                </span>
                            </div>
                            ${bet.status === 'settled' && bet.settled_at ? `
                                <div class="analysis-item">
                                    <span>ç»“ç®—æ—¶é—´:</span>
                                    <span>${formatTime(bet.settled_at)}</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `
        }

        // åˆå§‹åŒ–é¡µé¢
        function init() {
            document.getElementById('betDetail').innerHTML = renderBetDetail(bet175, round175)
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init)
    </script>
</body>

</html>